<!DOCTYPE html><html lang="en"><head><title>public/assets/js/admin/app</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../../"><meta name="groc-document-path" content="public/assets/js/admin/app"><meta name="groc-project-path" content="public/assets/js/admin/app.js"><link rel="stylesheet" type="text/css" media="all" href="../../../../assets/style.css"><script type="text/javascript" src="../../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">public/assets/js/admin/app.js</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-pi">"use strict"</span>;angular.module(<span class="hljs-string">"adminApp"</span>,[<span class="hljs-string">"ngResource"</span>,<span class="hljs-string">"ngTouch"</span>,<span class="hljs-string">"ngRoute"</span>,<span class="hljs-string">"ngLocale"</span>,<span class="hljs-string">"pascalprecht.translate"</span>,<span class="hljs-string">"ui.bootstrap"</span>,<span class="hljs-string">"ui.utils"</span>,<span class="hljs-string">"lr.upload"</span>,<span class="hljs-string">"ui.sortable"</span>]),angular.module(<span class="hljs-string">"adminApp"</span>).config([<span class="hljs-string">"$locationProvider"</span>,<span class="hljs-string">"$routeProvider"</span>,<span class="hljs-string">"$translateProvider"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($locationProvider,$routeProvider,$translateProvider)</span>{</span>$translateProvider.useUrlLoader(<span class="hljs-string">"/locale"</span>),$translateProvider.preferredLanguage(<span class="hljs-string">"es"</span>),$locationProvider.hashPrefix(<span class="hljs-string">"!"</span>),$routeProvider.otherwise({redirectTo:<span class="hljs-string">"/"</span>})}]),angular.module(<span class="hljs-string">"adminApp"</span>).run(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($rootScope,$timeout,$location,$translate,$locale,UserService)</span>{</span>$rootScope.$location=$location,$rootScope.$translate=$translate,$rootScope.$locale=$locale,$rootScope.$available_languages=[<span class="hljs-string">"es"</span>,<span class="hljs-string">"en"</span>],$timeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>UserService.get({id:$rootScope.user}).$promise.then(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(User)</span>{</span>$rootScope.user=User})}),$rootScope.$on(<span class="hljs-string">"$routeChangeStart"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>$rootScope.is_loading=!<span class="hljs-number">0</span>}),$rootScope.$on(<span class="hljs-string">"$routeChangeSuccess"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>$rootScope.is_loading=!<span class="hljs-number">1</span>})}),angular.module(<span class="hljs-string">"adminApp"</span>).factory(<span class="hljs-string">"ApartmentService"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($resource)</span>{</span><span class="hljs-keyword">return</span> $resource(<span class="hljs-string">"/admin/apartments/:id"</span>,{id:<span class="hljs-string">"@_id"</span>},{update:{method:<span class="hljs-string">"PUT"</span>}})}),angular.module(<span class="hljs-string">"adminApp"</span>).factory(<span class="hljs-string">"BookingService"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($resource)</span>{</span><span class="hljs-keyword">return</span> $resource(<span class="hljs-string">"/admin/bookings/:id"</span>,{id:<span class="hljs-string">"@_id"</span>},{update:{method:<span class="hljs-string">"PUT"</span>}})}),angular.module(<span class="hljs-string">"adminApp"</span>).factory(<span class="hljs-string">"CountryService"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($resource)</span>{</span><span class="hljs-keyword">return</span> $resource(<span class="hljs-string">"/admin/countries/:id"</span>,{id:<span class="hljs-string">"@_id"</span>},{update:{method:<span class="hljs-string">"PUT"</span>}})}),angular.module(<span class="hljs-string">"adminApp"</span>).factory(<span class="hljs-string">"ProvinceService"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($resource)</span>{</span><span class="hljs-keyword">return</span> $resource(<span class="hljs-string">"/admin/provinces/:id"</span>,{id:<span class="hljs-string">"@_id"</span>},{update:{method:<span class="hljs-string">"PUT"</span>}})}),angular.module(<span class="hljs-string">"adminApp"</span>).factory(<span class="hljs-string">"ServiceService"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($resource)</span>{</span><span class="hljs-keyword">return</span> $resource(<span class="hljs-string">"/admin/services/:id"</span>,{id:<span class="hljs-string">"@_id"</span>},{update:{method:<span class="hljs-string">"PUT"</span>}})}),angular.module(<span class="hljs-string">"adminApp"</span>).factory(<span class="hljs-string">"SpotService"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($resource)</span>{</span><span class="hljs-keyword">return</span> $resource(<span class="hljs-string">"/admin/spots/:id"</span>,{id:<span class="hljs-string">"@_id"</span>},{update:{method:<span class="hljs-string">"PUT"</span>}})}),angular.module(<span class="hljs-string">"adminApp"</span>).factory(<span class="hljs-string">"TownService"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($resource)</span>{</span><span class="hljs-keyword">return</span> $resource(<span class="hljs-string">"/admin/towns/:id"</span>,{id:<span class="hljs-string">"@_id"</span>},{update:{method:<span class="hljs-string">"PUT"</span>}})}),angular.module(<span class="hljs-string">"adminApp"</span>).factory(<span class="hljs-string">"UserService"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($resource)</span>{</span><span class="hljs-keyword">return</span> $resource(<span class="hljs-string">"/admin/users/:id"</span>,{id:<span class="hljs-string">"@_id"</span>},{update:{method:<span class="hljs-string">"PUT"</span>}})}),angular.module(<span class="hljs-string">"adminApp"</span>).factory(<span class="hljs-string">"$flash"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($rootScope)</span>{</span><span class="hljs-keyword">var</span> queue=[],show=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>queue.length&gt;<span class="hljs-number">0</span>?($rootScope.flash_message=queue[<span class="hljs-number">0</span>],queue.shift()):$rootScope.flash_message=<span class="hljs-literal">null</span>};<span class="hljs-keyword">return</span> $rootScope.$on(<span class="hljs-string">"$routeChangeSuccess"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>show()}),{show:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>show()},set:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(type,message)</span>{</span>queue.push({type:type,message:message})}}}),angular.module(<span class="hljs-string">"adminApp"</span>).directive(<span class="hljs-string">"backButton"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span><span class="hljs-keyword">return</span>{restrict:<span class="hljs-string">"A"</span>,link:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(scope,element)</span>{</span>element.addClass(<span class="hljs-string">"back-button"</span>),element.bind(<span class="hljs-string">"click"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>window.history.back()})}}}),angular.module(<span class="hljs-string">"adminApp"</span>).directive(<span class="hljs-string">"ngMatch"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span><span class="hljs-keyword">return</span>{<span class="hljs-built_in">require</span>:<span class="hljs-string">"ngModel"</span>,scope:{ngMatch:<span class="hljs-string">"="</span>},link:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(scope)</span>{</span>scope.$parent.$watch(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>console.log(scope.ngMatch)})}}}),angular.module(<span class="hljs-string">"adminApp"</span>).config([<span class="hljs-string">"$routeProvider"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($routeProvider)</span>{</span>$routeProvider.when(<span class="hljs-string">"/apartments"</span>,{templateUrl:<span class="hljs-string">"assets/js/admin/views/apartments/index.html"</span>,controller:<span class="hljs-string">"ApartmentsIndexCtrl"</span>,resolve:{Apartments:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ApartmentService)</span>{</span><span class="hljs-keyword">return</span> ApartmentService.query().$promise},Countries:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(CountryService)</span>{</span><span class="hljs-keyword">return</span> CountryService.query().$promise}}}).when(<span class="hljs-string">"/apartments/create"</span>,{templateUrl:<span class="hljs-string">"assets/js/admin/views/apartments/form.html"</span>,controller:<span class="hljs-string">"ApartmentsFormCtrl"</span>,resolve:{Apartment:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ApartmentService,$rootScope)</span>{</span><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ApartmentService({services:[],user:$rootScope.user._id})},Spots:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(SpotService)</span>{</span><span class="hljs-keyword">return</span> SpotService.query().$promise},Countries:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(CountryService)</span>{</span><span class="hljs-keyword">return</span> CountryService.query().$promise},Services:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ServiceService)</span>{</span><span class="hljs-keyword">return</span> ServiceService.query().$promise},Owners:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(UserService)</span>{</span><span class="hljs-keyword">return</span> UserService.query({group:<span class="hljs-number">3</span>}).$promise}}}).when(<span class="hljs-string">"/apartments/edit/:id"</span>,{templateUrl:<span class="hljs-string">"assets/js/admin/views/apartments/form.html"</span>,controller:<span class="hljs-string">"ApartmentsFormCtrl"</span>,resolve:{Apartment:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($rootScope,ApartmentService,$route)</span>{</span><span class="hljs-keyword">return</span> ApartmentService.get({id:$route.current.params.id}).$promise},Spots:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(SpotService)</span>{</span><span class="hljs-keyword">return</span> SpotService.query().$promise},Countries:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(CountryService)</span>{</span><span class="hljs-keyword">return</span> CountryService.query().$promise},Services:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ServiceService)</span>{</span><span class="hljs-keyword">return</span> ServiceService.query().$promise},Owners:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(UserService)</span>{</span><span class="hljs-keyword">return</span> UserService.query({group:<span class="hljs-number">3</span>}).$promise}}}).when(<span class="hljs-string">"/apartments/apartments/:id"</span>,{templateUrl:<span class="hljs-string">"assets/js/admin/views/apartments/apartments.html"</span>,controller:<span class="hljs-string">"ApartmentsApartmentsCtrl"</span>,resolve:{Apartment:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($rootScope,ApartmentService,$route)</span>{</span><span class="hljs-keyword">return</span> ApartmentService.get({id:$route.current.params.id}).$promise}}}).when(<span class="hljs-string">"/apartments/images/:id"</span>,{templateUrl:<span class="hljs-string">"assets/js/admin/views/apartments/images.html"</span>,controller:<span class="hljs-string">"ApartmentsImagesCtrl"</span>,resolve:{Apartment:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($rootScope,ApartmentService,$route)</span>{</span><span class="hljs-keyword">return</span> ApartmentService.get({id:$route.current.params.id}).$promise}}})}]),angular.module(<span class="hljs-string">"adminApp"</span>).controller(<span class="hljs-string">"ApartmentsIndexCtrl"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($rootScope,$filter,$flash,$scope,Apartments,Countries,ProvinceService,TownService)</span>{</span>$rootScope.current_section=<span class="hljs-string">"apartments"</span>,$scope.apartments=Apartments,$scope.search=$rootScope.apartment_search||{},$scope.countries=Countries,$scope.provinces=$scope.towns=[],$scope.$watch(<span class="hljs-string">"search"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>$rootScope.apartment_search=$scope.search}),$scope.$watch(<span class="hljs-string">"search.country"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(country)</span>{</span>country?$scope.provinces=ProvinceService.query({country:country}):($scope.provinces=$scope.towns=[],<span class="hljs-keyword">delete</span> $scope.search.country,<span class="hljs-keyword">delete</span> $scope.search.province,<span class="hljs-keyword">delete</span> $scope.search.town)}),$scope.$watch(<span class="hljs-string">"search.province"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(province)</span>{</span>province?$scope.towns=TownService.query({province:province}):($scope.towns=[],<span class="hljs-keyword">delete</span> $scope.search.province,<span class="hljs-keyword">delete</span> $scope.search.town)}),$scope.$watch(<span class="hljs-string">"search.town"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(town)</span>{</span>town||<span class="hljs-keyword">delete</span> $scope.search.town}),$scope.deleteApartment=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($index)</span>{</span>confirm($filter(<span class="hljs-string">"translate"</span>)(<span class="hljs-string">"admin.are_you_sure"</span>))&amp;&amp;$scope.apartments[$index].$<span class="hljs-keyword">delete</span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>$scope.apartments.splice($index,<span class="hljs-number">1</span>),$flash.set(<span class="hljs-string">"success"</span>,$filter(<span class="hljs-string">"translate"</span>)(<span class="hljs-string">"admin.apartments.apartment_has_been_delete"</span>)),$flash.show()})}}),angular.module(<span class="hljs-string">"adminApp"</span>).controller(<span class="hljs-string">"ApartmentsFormCtrl"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($rootScope,$scope,$translate,$filter,$flash,$location,Apartment,Spots,Countries,Services,ProvinceService,TownService,Owners)</span>{</span>$rootScope.current_section=<span class="hljs-string">"apartments"</span>,$scope.active_language=$translate.use(),$scope.apartment=Apartment,$scope.owners=Owners,$scope.spots=Spots,$scope.services=Services,$scope.countries=Countries,$scope.provinces=$scope.towns=[],$scope.setActiveLanguage=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(language)</span>{</span>$scope.active_language=language},$scope.loadProvinces=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span><span class="hljs-keyword">var</span> country=$scope.apartment.country;country?$scope.provinces=ProvinceService.query({country:country}):($scope.provinces=[],$scope.towns=[])},$scope.loadTowns=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span><span class="hljs-keyword">var</span> province=$scope.apartment.province;$scope.towns=province?TownService.query({province:province}):[]},Apartment._id?($scope.action=<span class="hljs-string">"editing"</span>,$scope.loadProvinces(),$scope.loadTowns()):$scope.action=<span class="hljs-string">"creating"</span>,$scope.activedService=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($id)</span>{</span><span class="hljs-keyword">return</span>-<span class="hljs-number">1</span>!==$scope.apartment.services.indexOf($id)?!<span class="hljs-number">0</span>:!<span class="hljs-number">1</span>},$scope.toggleService=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($id)</span>{</span><span class="hljs-keyword">if</span>($scope.activedService($id)){<span class="hljs-keyword">var</span> index=$scope.apartment.services.indexOf($id);$scope.apartment.services.splice(index,<span class="hljs-number">1</span>)}<span class="hljs-keyword">else</span> $scope.apartment.services.push($id);$scope.form.$setDirty()},$scope.cancel=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span><span class="hljs-keyword">return</span> $scope.form.$pristine||confirm($filter(<span class="hljs-string">"translate"</span>)(<span class="hljs-string">"admin.are_you_sure"</span>))?<span class="hljs-keyword">void</span> window.history.back():!<span class="hljs-number">1</span>},$scope.saveApartment=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>$scope.apartment._id?$scope.apartment.$update(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>$flash.set(<span class="hljs-string">"success"</span>,<span class="hljs-string">"admin.changes_has_been_saved"</span>),$location.path(<span class="hljs-string">"/apartments"</span>)}):$scope.apartment.$save(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>$flash.set(<span class="hljs-string">"success"</span>,<span class="hljs-string">"admin.changes_has_been_saved"</span>),$location.path(<span class="hljs-string">"/apartments"</span>)})};<span class="hljs-keyword">var</span> map=<span class="hljs-literal">null</span>,marker=<span class="hljs-literal">null</span>,coords=[<span class="hljs-number">40.41153868</span>,-<span class="hljs-number">3.70362707</span>],zoom=<span class="hljs-number">6</span>;$scope.apartment.geoposition&amp;&amp;(coords=$scope.apartment.geoposition.split(<span class="hljs-string">":"</span>)[<span class="hljs-number">0</span>].split(<span class="hljs-string">","</span>).map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span>{</span><span class="hljs-keyword">return</span> <span class="hljs-built_in">parseFloat</span>(a)}),zoom=<span class="hljs-built_in">parseInt</span>($scope.apartment.geoposition.split(<span class="hljs-string">":"</span>)[<span class="hljs-number">1</span>]));<span class="hljs-keyword">var</span> initMap=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span><span class="hljs-keyword">var</span> position=<span class="hljs-keyword">new</span> google.maps.LatLng(coords[<span class="hljs-number">0</span>],coords[<span class="hljs-number">1</span>]),mapOptions={center:position,zoom:zoom,scrollwheel:!<span class="hljs-number">1</span>,mapTypeId:google.maps.MapTypeId.HYBRID};map=<span class="hljs-keyword">new</span> google.maps.Map(document.getElementById(<span class="hljs-string">"map"</span>),mapOptions),marker=<span class="hljs-keyword">new</span> google.maps.Marker({map:map,position:position,draggable:!<span class="hljs-number">0</span>,animation:google.maps.Animation.DROP}),google.maps.event.addListener(marker,<span class="hljs-string">"dragend"</span>,$scope.setCoords),google.maps.event.addListener(map,<span class="hljs-string">"zoom_changed"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>$scope.apartment.geoposition=$scope.apartment.geoposition.replace(<span class="hljs-regexp">/\:(.*)/</span>,<span class="hljs-string">":"</span>+map.zoom),$scope.form.$setDirty(),$scope.$apply()})};$scope.centerAndSetMarkerOnAddress=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span><span class="hljs-keyword">var</span> search_address=$scope.search_address;<span class="hljs-keyword">if</span>(!search_address){<span class="hljs-keyword">var</span> country=$(<span class="hljs-string">"#input-country option:selected"</span>).html(),province=$(<span class="hljs-string">"#input-province option:selected"</span>).html(),town=$(<span class="hljs-string">"#input-town option:selected"</span>).html();search_address=$scope.apartment.address+<span class="hljs-string">", "</span>+town+<span class="hljs-string">", "</span>+province+<span class="hljs-string">", "</span>+country,$scope.search_address=search_address}<span class="hljs-keyword">var</span> geocoder=<span class="hljs-keyword">new</span> google.maps.Geocoder;geocoder.geocode({address:search_address},<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(results,status)</span>{</span>status===google.maps.GeocoderStatus.OK&amp;&amp;(map.setCenter(results[<span class="hljs-number">0</span>].geometry.location),map.setZoom(<span class="hljs-number">16</span>),marker.setPosition(results[<span class="hljs-number">0</span>].geometry.location),$scope.apartment.geoposition=results[<span class="hljs-number">0</span>].geometry.location.toString().slice(<span class="hljs-number">1</span>).slice(<span class="hljs-number">0</span>,-<span class="hljs-number">1</span>).replace(<span class="hljs-string">" "</span>,<span class="hljs-string">""</span>)+<span class="hljs-string">":"</span>+map.zoom,$scope.form.$setDirty(),$scope.$apply())})},$scope.setCoords=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ev)</span>{</span><span class="hljs-keyword">var</span> coords=ev.latLng.toString().slice(<span class="hljs-number">1</span>).slice(<span class="hljs-number">0</span>,-<span class="hljs-number">1</span>).replace(<span class="hljs-string">" "</span>,<span class="hljs-string">""</span>)+<span class="hljs-string">":"</span>+map.zoom;$scope.apartment.geoposition=coords,$scope.form.$setDirty(),$scope.$apply()},initMap()}),angular.module(<span class="hljs-string">"adminApp"</span>).controller(<span class="hljs-string">"ApartmentsApartmentsCtrl"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($rootScope,$timeout,$filter,$flash,$location,$scope,Apartment,ApartmentService)</span>{</span>$rootScope.current_section=<span class="hljs-string">"apartments"</span>,$scope.hasChanges=!<span class="hljs-number">1</span>,$scope.apartment_index=<span class="hljs-literal">null</span>,$scope.apartment=<span class="hljs-literal">null</span>,$scope.apartment_block=Apartment,$scope.apartments=Apartment.apartments||[],$scope.saveApartmentsBlock=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>ApartmentService.get({id:Apartment._id}).$promise.then(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(Apartment)</span>{</span>Apartment.apartments=$scope.apartments,Apartment.$update(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>$flash.set(<span class="hljs-string">"success"</span>,<span class="hljs-string">"admin.changes_has_been_saved"</span>),window.history.back()})})},$scope.addApartment=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>$scope.apartment={seasons:[],closed:[]}},$scope.cancelApartment=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>($scope.apartmentForm.$pristine||confirm($filter(<span class="hljs-string">"translate"</span>)(<span class="hljs-string">"admin.are_you_sure"</span>)))&amp;&amp;($scope.apartment=$scope.apartment_index=<span class="hljs-literal">null</span>)},$scope.saveApartment=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span><span class="hljs-literal">null</span>!==$scope.apartment_index?$scope.apartments[$scope.apartment_index]=angular.copy($scope.apartment):$scope.apartments.push(angular.copy($scope.apartment)),$scope.apartment=$scope.apartment_index=<span class="hljs-literal">null</span>,$scope.apartmentForm.$setPristine(),$scope.hasChanges=!<span class="hljs-number">0</span>},$scope.editApartment=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($index)</span>{</span>$scope.apartment=angular.copy($scope.apartments[$index]),$scope.apartment_index=$index},$scope.deleteApartment=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>confirm($filter(<span class="hljs-string">"translate"</span>)(<span class="hljs-string">"admin.are_you_sure"</span>))&amp;&amp;($scope.apartments.splice($scope.apartment_index,<span class="hljs-number">1</span>),$scope.apartment=$scope.apartment_index=<span class="hljs-literal">null</span>)},$scope.duplicateApartment=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span><span class="hljs-keyword">var</span> apartment=angular.copy($scope.apartment);$scope.apartment_index=<span class="hljs-literal">null</span>,$scope.apartment=<span class="hljs-literal">null</span>,$timeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>$scope.apartment=apartment,$scope.$apply()},<span class="hljs-number">100</span>)},$scope.season_index=$scope.closed_index=<span class="hljs-literal">null</span>,$scope.season=$scope.closed=<span class="hljs-literal">null</span>,$scope.addSeason=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>$scope.season={}},$scope.cancelSeason=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>$scope.season=<span class="hljs-literal">null</span>,$scope.season_index=<span class="hljs-literal">null</span>},$scope.saveSeason=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span><span class="hljs-literal">null</span>!==$scope.season_index?$scope.apartment.seasons[$scope.season_index]=angular.copy($scope.season):$scope.apartment.seasons.push($scope.season),$scope.season=$scope.season_index=<span class="hljs-literal">null</span>,$scope.apartmentForm.$setDirty()},$scope.editSeason=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($index)</span>{</span>$scope.season_index=$index,$scope.season={},$scope.season=angular.copy($scope.apartment.seasons[$index]),$scope.renderSeasonDates()},$scope.deleteSeason=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($index)</span>{</span>confirm($filter(<span class="hljs-string">"translate"</span>)(<span class="hljs-string">"admin.are_you_sure"</span>))&amp;&amp;$scope.apartment.seasons.splice($index,<span class="hljs-number">1</span>)},$scope.addClosed=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>$scope.closed={}},$scope.cancelClosed=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>$scope.closed=<span class="hljs-literal">null</span>,$scope.closed_index=<span class="hljs-literal">null</span>},$scope.saveClosed=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span><span class="hljs-literal">null</span>!==$scope.closed_index?$scope.apartment.closed[$scope.closed_index]=angular.copy($scope.closed):$scope.apartment.closed.push($scope.closed),$scope.closed=$scope.closed_index=<span class="hljs-literal">null</span>,$scope.apartmentForm.$setDirty()},$scope.editClosed=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($index)</span>{</span>$scope.closed_index=$index,$scope.closed={},$scope.closed=angular.copy($scope.apartment.closed[$index]),$scope.renderClosedDates()},$scope.deleteClosed=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($index)</span>{</span>confirm($filter(<span class="hljs-string">"translate"</span>)(<span class="hljs-string">"admin.are_you_sure"</span>))&amp;&amp;$scope.apartment.closed.splice($index,<span class="hljs-number">1</span>)},$scope.dateOptions={startingDay:<span class="hljs-number">1</span>,showWeeks:!<span class="hljs-number">1</span>,showButtonBar:!<span class="hljs-number">1</span>},$scope.renderSeasonDates=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>angular.element($(<span class="hljs-string">"#input-season-from"</span>)).controller(<span class="hljs-string">"ngModel"</span>).$setViewValue(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>($scope.season.from)),angular.element($(<span class="hljs-string">"#input-season-from"</span>)).controller(<span class="hljs-string">"ngModel"</span>).$render(),angular.element($(<span class="hljs-string">"#input-season-to"</span>)).controller(<span class="hljs-string">"ngModel"</span>).$setViewValue(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>($scope.season.to)),angular.element($(<span class="hljs-string">"#input-season-to"</span>)).controller(<span class="hljs-string">"ngModel"</span>).$render()},$scope.renderClosedDates=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>angular.element($(<span class="hljs-string">"#input-closed-from"</span>)).controller(<span class="hljs-string">"ngModel"</span>).$setViewValue(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>($scope.closed.from)),angular.element($(<span class="hljs-string">"#input-closed-from"</span>)).controller(<span class="hljs-string">"ngModel"</span>).$render(),angular.element($(<span class="hljs-string">"#input-closed-to"</span>)).controller(<span class="hljs-string">"ngModel"</span>).$setViewValue(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>($scope.closed.to)),angular.element($(<span class="hljs-string">"#input-closed-to"</span>)).controller(<span class="hljs-string">"ngModel"</span>).$render()},$scope.cancel=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span><span class="hljs-keyword">return</span> $scope.hasChanges&amp;&amp;!confirm($filter(<span class="hljs-string">"translate"</span>)(<span class="hljs-string">"admin.are_you_sure"</span>))?!<span class="hljs-number">1</span>:<span class="hljs-keyword">void</span> window.history.back()}}),angular.module(<span class="hljs-string">"adminApp"</span>).controller(<span class="hljs-string">"ApartmentsImagesCtrl"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($rootScope,$scope,$filter,$flash,$location,Apartment,ApartmentService)</span>{</span>$rootScope.current_section=<span class="hljs-string">"apartments"</span>,$scope.apartment=Apartment,$scope.images=Apartment.images||[],$scope.uploading=[],$scope.uploadStart=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(files)</span>{</span>$scope.uploading=files},$scope.deleteImage=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($index)</span>{</span>confirm($filter(<span class="hljs-string">"translate"</span>)(<span class="hljs-string">"admin.are_you_sure"</span>))&amp;&amp;$scope.images.splice($index,<span class="hljs-number">1</span>)},$scope.uploadComplete=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span>{</span><span class="hljs-keyword">var</span> images=[];$.each(response.data,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(index,item)</span>{</span>images.push({file:item})}),$scope.images=$scope.images.concat(images)},$scope.saveImages=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>ApartmentService.get({id:Apartment._id}).$promise.then(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(Apartment)</span>{</span>Apartment.images=$scope.images,Apartment.$update(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>$flash.set(<span class="hljs-string">"success"</span>,<span class="hljs-string">"admin.changes_has_been_saved"</span>),window.history.back()})})},$scope.cancel=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span><span class="hljs-keyword">return</span> confirm($filter(<span class="hljs-string">"translate"</span>)(<span class="hljs-string">"admin.are_you_sure"</span>))?<span class="hljs-keyword">void</span> window.history.back():!<span class="hljs-number">1</span>}}),angular.module(<span class="hljs-string">"adminApp"</span>).config([<span class="hljs-string">"$routeProvider"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($routeProvider)</span>{</span>$routeProvider.when(<span class="hljs-string">"/bookings"</span>,{templateUrl:<span class="hljs-string">"assets/js/admin/views/bookings/index.html"</span>,controller:<span class="hljs-string">"BookingsIndexCtrl"</span>,resolve:{Apartments:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($q,ApartmentService,BookingService)</span>{</span><span class="hljs-keyword">var</span> apartmentsDeferred=$q.defer(),bookingsDeferred=$q.defer();ApartmentService.query(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(apartments)</span>{</span>apartmentsDeferred.resolve(apartments)});<span class="hljs-keyword">var</span> resolvedApartments=<span class="hljs-number">0</span>,apartmentsWithBookings=[];<span class="hljs-keyword">return</span> apartmentsDeferred.promise.then(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(apartments)</span>{</span>angular.forEach(apartments,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(apartment)</span>{</span>BookingService.query({apartment_block:apartment._id},<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(bookings)</span>{</span>bookings.length&gt;<span class="hljs-number">0</span>&amp;&amp;(apartment.bookings=bookings,apartmentsWithBookings.push(apartment)),++resolvedApartments==apartments.length&amp;&amp;bookingsDeferred.resolve(apartmentsWithBookings)})})}),bookingsDeferred.promise},Countries:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(CountryService)</span>{</span><span class="hljs-keyword">return</span> CountryService.query().$promise}}})}]),angular.module(<span class="hljs-string">"adminApp"</span>).controller(<span class="hljs-string">"BookingsIndexCtrl"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($rootScope,$scope,Apartments)</span>{</span>$rootScope.current_section=<span class="hljs-string">"bookings"</span>,$scope.apartments=Apartments,$scope.justWithBookings=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(apartment)</span>{</span><span class="hljs-keyword">return</span> apartment.bookings?!<span class="hljs-number">0</span>:!<span class="hljs-number">1</span>}}),angular.module(<span class="hljs-string">"adminApp"</span>).config([<span class="hljs-string">"$routeProvider"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($routeProvider)</span>{</span>$routeProvider.when(<span class="hljs-string">"/"</span>,{templateUrl:<span class="hljs-string">"assets/js/admin/views/dashboard/index.html"</span>,controller:<span class="hljs-string">"DashboardCtrl"</span>})}]),angular.module(<span class="hljs-string">"adminApp"</span>).controller(<span class="hljs-string">"DashboardCtrl"</span>,[<span class="hljs-string">"$rootScope"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($rootScope)</span>{</span>$rootScope.current_section=<span class="hljs-string">"dashboard"</span>}]),angular.module(<span class="hljs-string">"adminApp"</span>).config([<span class="hljs-string">"$routeProvider"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($routeProvider)</span>{</span>$routeProvider.when(<span class="hljs-string">"/users"</span>,{templateUrl:<span class="hljs-string">"assets/js/admin/views/users/index.html"</span>,controller:<span class="hljs-string">"UsersIndexCtrl"</span>,resolve:{Users:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(UserService)</span>{</span><span class="hljs-keyword">return</span> UserService.query().$promise}}}).when(<span class="hljs-string">"/users/create"</span>,{templateUrl:<span class="hljs-string">"assets/js/admin/views/users/form.html"</span>,controller:<span class="hljs-string">"UsersFormCtrl"</span>,resolve:{User:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(UserService)</span>{</span><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> UserService},Countries:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(CountryService)</span>{</span><span class="hljs-keyword">return</span> CountryService.query()}}}).when(<span class="hljs-string">"/users/edit/:id"</span>,{templateUrl:<span class="hljs-string">"assets/js/admin/views/users/form.html"</span>,controller:<span class="hljs-string">"UsersFormCtrl"</span>,resolve:{User:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(UserService,$route)</span>{</span><span class="hljs-keyword">return</span> UserService.get({id:$route.current.params.id}).$promise},Countries:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(CountryService)</span>{</span><span class="hljs-keyword">return</span> CountryService.query()}}})}]),angular.module(<span class="hljs-string">"adminApp"</span>).controller(<span class="hljs-string">"UsersIndexCtrl"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($scope,$rootScope,$filter,$flash,$timeout,Users)</span>{</span>$rootScope.current_section=<span class="hljs-string">"users"</span>,$scope.users=Users,$scope.deleteUser=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($index)</span>{</span>confirm($filter(<span class="hljs-string">"translate"</span>)(<span class="hljs-string">"admin.are_you_sure"</span>))&amp;&amp;$scope.users[$index].$<span class="hljs-keyword">delete</span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>$flash.set(<span class="hljs-string">"success"</span>,<span class="hljs-string">"admin.object_has_been_removed"</span>),$flash.show(),$scope.users.splice($index,<span class="hljs-number">1</span>)})}}),angular.module(<span class="hljs-string">"adminApp"</span>).controller(<span class="hljs-string">"UsersFormCtrl"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($scope,$rootScope,$filter,$location,$flash,User,Countries)</span>{</span>$rootScope.current_section=<span class="hljs-string">"users"</span>,$scope.action=User._id?<span class="hljs-string">"editing"</span>:<span class="hljs-string">"creating"</span>,$scope.groups={<span class="hljs-number">2</span>:<span class="hljs-string">"admin"</span>,<span class="hljs-number">3</span>:<span class="hljs-string">"owner"</span>,<span class="hljs-number">4</span>:<span class="hljs-string">"customer"</span>},$scope.countries=Countries,$scope.user=User,$scope.dateOptions={startingDay:<span class="hljs-number">1</span>,showWeeks:!<span class="hljs-number">1</span>,showButtonBar:!<span class="hljs-number">1</span>},$scope.openDatePicker=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>$scope.opened=!<span class="hljs-number">0</span>},<span class="hljs-number">1</span>===User.group&amp;&amp;($scope.groups[<span class="hljs-number">1</span>]=<span class="hljs-string">"root"</span>),$scope.saveUser=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>$scope.password&amp;&amp;($scope.user.password=$scope.password),$scope.user._id?$scope.user.$update(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>$flash.set(<span class="hljs-string">"success"</span>,<span class="hljs-string">"admin.changes_has_been_saved"</span>),$location.path($rootScope.user.group&gt;<span class="hljs-number">2</span>?<span class="hljs-string">"/"</span>:<span class="hljs-string">"/users"</span>)}):$scope.user.$save(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>$flash.set(<span class="hljs-string">"success"</span>,<span class="hljs-string">"admin.changes_has_been_saved"</span>),$location.path(<span class="hljs-string">"/users"</span>)})},$scope.uploadStart=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>},$scope.uploadComplete=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span>{</span>$scope.user.image=response.data,$scope.form.$setDirty()},$scope.deleteImage=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>confirm($filter(<span class="hljs-string">"translate"</span>)(<span class="hljs-string">"admin.are_you_sure"</span>))&amp;&amp;($scope.user.image=<span class="hljs-literal">null</span>)},$scope.cancel=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span><span class="hljs-keyword">return</span> $scope.form.$pristine||confirm($filter(<span class="hljs-string">"translate"</span>)(<span class="hljs-string">"admin.are_you_sure"</span>))?<span class="hljs-keyword">void</span> window.history.back():!<span class="hljs-number">1</span>}});</div></div></div></div></body></html>