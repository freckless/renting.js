"use strict";angular.module("adminApp",["ngResource","ngTouch","ngRoute","ngLocale","pascalprecht.translate","ui.bootstrap","ui.utils"]),angular.module("adminApp").config(["$locationProvider","$routeProvider","$translateProvider",function($locationProvider,$routeProvider,$translateProvider){$translateProvider.useUrlLoader("/locale"),$translateProvider.preferredLanguage("es"),$locationProvider.hashPrefix("!"),$routeProvider.otherwise({redirectTo:"/"})}]),angular.module("adminApp").run(["$rootScope","$location","$translate","$locale",function($rootScope,$location,$translate,$locale){$rootScope.$location=$location,$rootScope.$translate=$translate,$rootScope.$locale=$locale,$rootScope.$on("$routeChangeStart",function(){$rootScope.is_loading=!0}),$rootScope.$on("$routeChangeSuccess",function(){$rootScope.is_loading=!1})}]),angular.module("adminApp").factory("ApartmentService",function($resource){return $resource("/admin/apartments/:id",{id:"@_id"},{update:{method:"PUT"}})}),angular.module("adminApp").factory("CountryService",function($resource){return $resource("/admin/countries/:id",{id:"@_id"},{update:{method:"PUT"}})}),angular.module("adminApp").factory("ProvinceService",function($resource){return $resource("/admin/provinces/:id",{id:"@_id"},{update:{method:"PUT"}})}),angular.module("adminApp").factory("SpotService",function($resource){return $resource("/admin/spots/:id",{id:"@_id"},{update:{method:"PUT"}})}),angular.module("adminApp").factory("TownService",function($resource){return $resource("/admin/towns/:id",{id:"@_id"},{update:{method:"PUT"}})}),angular.module("adminApp").factory("UserService",function($resource){return $resource("/admin/users/:id",{id:"@_id"},{update:{method:"PUT"}})}),angular.module("adminApp").factory("$flash",function($rootScope){var queue=[],show=function(){queue.length>0?($rootScope.flash_message=queue[0],queue.shift()):$rootScope.flash_message=null};return $rootScope.$on("$routeChangeSuccess",function(){show()}),{show:function(){show()},set:function(type,message){console.log("here-set"),queue.push({type:type,message:message})}}}),angular.module("adminApp").directive("backButton",function(){return{restrict:"A",link:function(scope,element){element.addClass("back-button"),element.bind("click",function(){window.history.back()})}}}),angular.module("adminApp").directive("ngMatch",function(){return{require:"ngModel",scope:{ngMatch:"="},link:function(scope){scope.$parent.$watch(function(){console.log(scope.ngMatch)})}}}),angular.module("adminApp").config(["$routeProvider",function($routeProvider){$routeProvider.when("/apartments",{templateUrl:"assets/js/admin/views/apartments/index.html",controller:"ApartmentsIndexCtrl",resolve:{Apartments:function(ApartmentService){return ApartmentService.query().$promise}}}).when("/apartments/create",{templateUrl:"assets/js/admin/views/apartments/form.html",controller:"ApartmentsFormCtrl",resolve:{Apartment:function(ApartmentService){return new ApartmentService},Spots:function(SpotService){return SpotService.query().$promise},Countries:function(CountryService){return CountryService.query().$promise}}}).when("/apartments/edit/:id",{templateUrl:"assets/js/admin/views/apartments/form.html",controller:"ApartmentsFormCtrl",resolve:{Apartment:function(ApartmentService,$route){return ApartmentService.get({id:$route.current.params.id})}}})}]),angular.module("adminApp").controller("ApartmentsIndexCtrl",function($rootScope,$scope,Apartments){$rootScope.current_section="apartments",$scope.apartments=Apartments}),angular.module("adminApp").controller("ApartmentsFormCtrl",function($rootScope,$scope,Apartment,Spots,Countries,ProvinceService){$rootScope.current_section="apartments",$scope.action=Apartment._id?"editing":"creating",$scope.apartment=Apartment,$scope.spots=Spots,$scope.countries=Countries,console.log(Countries),$scope.provinces=$scope.towns=[],$scope.loadProvinces=function(){console.log("here");var country=$scope.apartment.country;$scope.provinces=ProvinceService.query({country:country})},$scope.loadTowns=function(){var province=$scope.apartment.province;$scope.towns=ProvinceService.query({country:province})}}),angular.module("adminApp").config(["$routeProvider",function($routeProvider){$routeProvider.when("/bookings",{templateUrl:"assets/js/admin/views/bookings/index.html",controller:"BookingsIndexCtrl"})}]),angular.module("adminApp").controller("BookingsIndexCtrl",["$rootScope",function($rootScope){$rootScope.current_section="bookings"}]),angular.module("adminApp").config(["$routeProvider",function($routeProvider){$routeProvider.when("/",{templateUrl:"assets/js/admin/views/dashboard/index.html",controller:"DashboardCtrl"})}]),angular.module("adminApp").controller("DashboardCtrl",["$rootScope",function($rootScope){$rootScope.current_section="dashboard"}]),angular.module("adminApp").config(["$routeProvider",function($routeProvider){$routeProvider.when("/users",{templateUrl:"assets/js/admin/views/users/index.html",controller:"UsersIndexCtrl",resolve:{Users:function(UserService){return UserService.query().$promise}}}).when("/users/create",{templateUrl:"assets/js/admin/views/users/form.html",controller:"UsersFormCtrl",resolve:{User:function(UserService){return new UserService}}}).when("/users/edit/:id",{templateUrl:"assets/js/admin/views/users/form.html",controller:"UsersFormCtrl",resolve:{User:function(UserService,$route){return UserService.get({id:$route.current.params.id}).$promise}}})}]),angular.module("adminApp").controller("UsersIndexCtrl",function($scope,$rootScope,$filter,$flash,$timeout,Users){$rootScope.current_section="users",$scope.users=Users,$scope.deleteUser=function($index){confirm($filter("translate")("admin.are_you_sure"))&&$scope.users[$index].$delete(function(){$flash.set("success","admin.object_has_been_removed"),$flash.show(),$scope.users.splice($index,1)})}}),angular.module("adminApp").controller("UsersFormCtrl",function($scope,$rootScope,$filter,$location,$flash,User){$rootScope.current_section="users",$scope.action=User._id?"editing":"creating",$scope.groups={2:"admin",3:"owner",4:"customer"},$scope.user=User,$scope.dateOptions={startingDay:1,showWeeks:!1,showButtonBar:!1},$scope.openDatePicker=function(){$scope.opened=!0},1===User.group&&($scope.groups[1]="root"),$scope.saveUser=function(){$scope.password&&($scope.user.password=$scope.password),$scope.user._id?$scope.user.$update(function(){$flash.set("success","admin.changes_has_been_saved"),$location.path("/users")}):$scope.user.$save(function(){$flash.set("success","admin.changes_has_been_saved"),$location.path("/users")})},$scope.cancel=function(){return $scope.form.$pristine||confirm($filter("translate")("admin.are_you_sure"))?void window.history.back():!1}});